#!/bin/sh
set -e

# USAGE: jenkinsfile-lint [filename]
#        cat some_file | jenkinsfile-lint

if [ -z "$JENKINS_URL" ]; then
  echo "No value for JENKINS_URL has been set" >&2
  exit 1
fi

# Use STDIN if possible, else assume 'Jenkinsfile' in current directory
if [ $# -eq 0 ] && [ ! -t 0 ]; then
  JENKINSFILE=$(cat -)
else
  JENKINSFILE=$(cat "${1:-Jenkinsfile}")
fi

curl --netrc --insecure --silent -X POST --data-urlencode "jenkinsfile=$JENKINSFILE" "${JENKINS_URL}/pipeline-model-converter/validate"
