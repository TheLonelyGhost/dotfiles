#!/bin/bash
set -e

cat <<MSG
===============================================
||      Updating Debian/Ubuntu Packages      ||
===============================================
MSG

PACKAGES=""
function __add_package() {
  PACKAGES="$1 $PACKAGES"
}

# ----------------------
# | Add packages below |
# ----------------------

__add_package "apt-transport-https"

# Dev and compiling tools
__add_package "build-essential"
__add_package "openssl"

# Ruby
__add_package "ruby-dev"

# Dev command line goodies
__add_package "tree"
__add_package "exuberant-ctags"
__add_package "silversearcher-ag"
__add_package "dos2unix"
__add_package "xclip"
__add_package "tmux"

# NodeJS
__add_package "nodejs"
__add_package "npm"

# Go
__add_package "golang"

# Crypto
__add_package "keychain"
__add_package "gnupg-agent"
__add_package "gnupg2"

# Graphical dependencies
if command -v Xorg &>/dev/null; then
  [ -e /etc/apt/sources.list.d/nixnote-*.list ] || \
    sudo add-apt-repository -y ppa:nixnote/nixnote2-daily &>/dev/null
  __add_package "nixnote2"

  [ -e /etc/apt/sources.list.d/no1wantdthisname-*.list ] || \
    sudo add-apt-repository -y ppa:no1wantdthisname/ppa &>/dev/null
  __add_package "fontconfig-infinality"
fi

# ------------------------
# | Done adding packages |
# ------------------------

cat <<MSG
---------------------------------
>> PACKAGES: $PACKAGES
---------------------------------
MSG
sudo apt-get update -y
sudo apt-get install -y $PACKAGES

# Configuring infinality, if needed
if [[ "$(readlink /etc/fonts/infinality/conf.d 2>/dev/null)" != *linux* ]]; then
  ln -frs /etc/fonts/infinality/styles.conf.avail/linux /etc/fonts/infinality/conf.d
fi

# Create alias commands for drop-in replacements of antiquated tools:

if ! command -v ctags &>/dev/null; then
  if command -v ctags-exuberant &>/dev/null; then
    sudo ln -v -s "$(command -v ctags-exuberant)" "/usr/local/bin/ctags"
  else
    echo "ctags (as either \`ctags' or \`ctags-exuberant') is not installed" 1>&2
  fi
fi

if ! command -v node &>/dev/null; then
  if command -v nodejs &>/dev/null; then
    sudo ln -v -s "$(command -v nodejs)" "/usr/local/bin/node"
  else
    echo "NodeJS (as either \`node' or \`nodejs') is not installed" 1>&2
  fi
fi

cat <<MSG
---------------------------------
>> Done.
---------------------------------
MSG
