#!/bin/bash
set -e

cat <<MSG
===============================================
||      Updating Debian/Ubuntu Packages      ||
===============================================
MSG

INSTALLABLE_PACKAGES=(apt-transport-https)

# Dev and compiling tools
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} build-essential)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} openssl)

# Ruby
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} ruby-dev)

# Dev command line goodies
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} exuberant-ctags)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} silversearcher-ag)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} dos2unix)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} xclip)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} tmux)

# NodeJS
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} nodejs)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} npm)

# Go
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} golang)

# Crypto
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} keychain)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} gnupg-agent)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} gnupg2)
INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} npm)

if command -v Xorg &>/dev/null; then
  cat <<MSG
----------------------------------------
|    Adding Graphical Dependencies     |
----------------------------------------
MSG

  [ -e /etc/apt/sources.list.d/nixnote-*.list ] || \
    sudo add-apt-repository -y ppa:nixnote/nixnote2-daily &>/dev/null
  INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} nixnote2)

  [ -e /etc/apt/sources.list.d/no1wantdthisname-*.list ] || \
    sudo add-apt-repository -y ppa:no1wantdthisname/ppa &>/dev/null
  INSTALLABLE_PACKAGES=(${INSTALLABLE_PACKAGES[@]} fontconfig-infinality)
fi

sudo apt-get update -y
sudo apt-get install -y ${INSTALLABLE_PACKAGES[@]}

# Configuring infinality, if needed
if [[ "$(readlink /etc/fonts/infinality/conf.d 2>/dev/null)" != *linux* ]]; then
  ln -frs /etc/fonts/infinality/styles.conf.avail/linux /etc/fonts/infinality/conf.d
fi

cat <<MSG
Creating alias commands for Debian/Ubuntu package drop-in replacements...
MSG

if ! command -v ctags &>/dev/null; then
  if command -v ctags-exuberant &>/dev/null; then
    sudo ln -v -s "$(command -v ctags-exuberant)" "/usr/local/bin/ctags"
  else
    echo "ctags (as either \`ctags' or \`ctags-exuberant') is not installed" 1>&2
  fi
fi

if ! command -v node &>/dev/null; then
  if command -v nodejs &>/dev/null; then
    sudo ln -v -s "$(command -v nodejs)" "/usr/local/bin/node"
  else
    echo "NodeJS (as either \`node' or \`nodejs') is not installed" 1>&2
  fi
fi
