#!/usr/bin/env bash
# vim: syn=sh

source "${XDG_HOME:-${HOME}/.config}/direnv/lib.sh"
source "${XDG_HOME:-${HOME}/.config}/direnv/python.sh"
source "${XDG_HOME:-${HOME}/.config}/direnv/node.sh"
source "${XDG_HOME:-${HOME}/.config}/direnv/ruby.sh"
source "${XDG_HOME:-${HOME}/.config}/direnv/java.sh"
source "${XDG_HOME:-${HOME}/.config}/direnv/kubernetes.sh"

use_chef() {
  if has chef; then
    direnv_load chef shell-init "$(basename -- "$SHELL")"
    # Compliments the chef completion stuff already in the bash/zsh configs
    eval "$(chef shell-init "$(basename "$SHELL")" | grep -e '^export ')"
    export CHEF_ENV="dev"
  else
    log_error "Please install ChefDK to use the 'use chef' feature"
    return 1
  fi
}

use_terraform() {
  local version
  version="${1:-11}"
  mkdir -p "$(direnv_layout_dir)/bin"
  if [ -x "${HOME}/.bin/terraform${version}" ]; then
    command ln -fs "${HOME}/.bin/terraform${version}" "$(direnv_layout_dir)/bin/terraform"
  else
    log_error "No such version '${version}' of terraform (or no binary \`~/.bin/terraform${version}')"
  fi

  path_add "PATH" "$(direnv_layout_dir)/bin"
}
